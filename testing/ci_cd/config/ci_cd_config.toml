# MultiOS CI/CD Pipeline Configuration

# Global CI/CD Settings
[global]
pipeline_timeout = 7200  # 2 hours
max_concurrent_jobs = 8
retry_failed_jobs = true
retry_attempts = 3

# Architecture-specific settings
[architectures]
x86_64 = {
    enabled = true,
    qemu_machine = "pc-q35-6.2",
    qemu_memory = "4G",
    qemu_cpu = 4,
    cross_compile = false,
    native_compile = true
}
arm64 = {
    enabled = true,
    qemu_machine = "virt",
    qemu_memory = "4G",
    qemu_cpu = 4,
    cross_compile = true,
    qemu_target = "qemu-system-aarch64"
}
riscv64 = {
    enabled = true,
    qemu_machine = "spike_virt",
    qemu_memory = "4G",
    qemu_cpu = 4,
    cross_compile = true,
    qemu_target = "qemu-system-riscv64"
}

# Test configuration
[tests]
unit_tests = {
    enabled = true,
    timeout = 300,
    parallel = true,
    coverage_enabled = true,
    coverage_threshold = 80
}
integration_tests = {
    enabled = true,
    timeout = 600,
    qemu_enabled = true,
    network_enabled = false,
    stress_tests = false
}
performance_tests = {
    enabled = true,
    timeout = 900,
    benchmarks = ["boot_time", "memory_usage", "cpu_performance", "io_throughput"],
    baseline_comparison = true
}
security_tests = {
    enabled = true,
    timeout = 300,
    audit_enabled = true,
    clippy_enabled = true,
    allowed_vulnerabilities = ["none"]
}

# Build configuration
[build]
release_mode = false
debug_mode = true
features = ["all-features"]
strip_binaries = true
generate_docs = true
parallel_builds = true

# Quality gates
[quality_gates]
min_code_coverage = 80
min_test_pass_rate = 95
max_performance_regression = 5
max_security_issues = 0
require_all_arch_success = true

# Container settings
[containers]
base_images = ["debian:bookworm-slim", "ubuntu:22.04", "alpine:3.18", "fedora:38"]
test_timeout = 3600
cleanup_containers = true

# Artifact management
[artifacts]
storage_path = "/workspace/artifacts"
retention_days = 30
compression = true
encryption = false
registry_upload = true

# Monitoring integration
[monitoring]
dashboard_url = "http://localhost:8080"
prometheus_metrics = true
alerting_enabled = true
performance_tracking = true

# Notification settings
[notifications]
slack_webhook = "${SLACK_WEBHOOK}"
discord_webhook = "${DISCORD_WEBHOOK}"
email_recipients = "${EMAIL_RECIPIENTS}"
github_status = true
on_success = true
on_failure = true
on_regression = true

# Performance baseline thresholds
[performance_baselines]
boot_time = {
    x86_64 = { target_ms = 500, max_regression_percent = 10 },
    arm64 = { target_ms = 600, max_regression_percent = 15 },
    riscv64 = { target_ms = 800, max_regression_percent = 20 }
}
memory_usage = {
    x86_64 = { target_mb = 512, max_regression_percent = 20 },
    arm64 = { target_mb = 512, max_regression_percent = 20 },
    riscv64 = { target_mb = 512, max_regression_percent = 20 }
}
cpu_performance = {
    x86_64 = { target_score = 100, min_score = 90 },
    arm64 = { target_score = 80, min_score = 70 },
    riscv64 = { target_score = 60, min_score = 50 }
}