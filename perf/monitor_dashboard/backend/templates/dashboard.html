<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Performance Monitoring Dashboard</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        .card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .metric-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .metric-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
        .metric-value {
            font-size: 2em;
            font-weight: bold;
            margin: 10px 0;
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-ok { background: #4CAF50; }
        .status-warning { background: #FF9800; }
        .status-critical { background: #F44336; }
        .loading {
            text-align: center;
            padding: 40px;
            color: white;
        }
        .progress-bar {
            background: rgba(255,255,255,0.2);
            border-radius: 10px;
            height: 20px;
            overflow: hidden;
            margin: 10px 0;
        }
        .progress-fill {
            height: 100%;
            background: rgba(255,255,255,0.8);
            border-radius: 10px;
            transition: width 0.3s ease;
        }
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        .pulse {
            animation: pulse 2s infinite;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Performance Monitoring Dashboard</h1>
            <p>Real-time system performance monitoring and analytics</p>
        </div>

        <div id="dashboard-content">
            <div class="loading">
                <div class="pulse">ðŸ”„ Loading dashboard...</div>
            </div>
        </div>
    </div>

    <script>
        // Simple dashboard implementation
        const apiBase = 'http://localhost:5000';
        
        async function loadMetrics() {
            try {
                const response = await fetch(`${apiBase}/api/metrics/current`);
                const result = await response.json();
                
                if (result.success) {
                    renderDashboard(result.data);
                }
            } catch (error) {
                console.error('Error loading metrics:', error);
                document.getElementById('dashboard-content').innerHTML = `
                    <div class="card">
                        <h2>Connection Error</h2>
                        <p>Unable to connect to the monitoring service. Please ensure the backend is running.</p>
                        <p>Start the backend with: python start_dashboard.py --mode web</p>
                    </div>
                `;
            }
        }
        
        function renderDashboard(data) {
            const content = document.getElementById('dashboard-content');
            
            const cpu = data.cpu || {};
            const memory = data.memory || {};
            const disk = data.disk || {};
            const network = data.network || {};
            
            content.innerHTML = `
                <div class="metric-grid">
                    <div class="metric-card">
                        <h3>CPU Usage</h3>
                        <div class="metric-value">${(cpu.cpu_percent || 0).toFixed(1)}%</div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${cpu.cpu_percent || 0}%"></div>
                        </div>
                        <p>${cpu.cpu_count || 0} cores</p>
                    </div>
                    
                    <div class="metric-card">
                        <h3>Memory Usage</h3>
                        <div class="metric-value">${(memory.virtual_memory?.percent || 0).toFixed(1)}%</div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${memory.virtual_memory?.percent || 0}%"></div>
                        </div>
                        <p>${((memory.virtual_memory?.used || 0) / 1024**3).toFixed(1)} GB used</p>
                    </div>
                    
                    <div class="metric-card">
                        <h3>Disk Usage</h3>
                        <div class="metric-value">
                            ${Object.values(disk.disk_usage || {})[0]?.percent?.toFixed(1) || 0}%
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${Object.values(disk.disk_usage || {})[0]?.percent || 0}%"></div>
                        </div>
                        <p>${Object.keys(disk.disk_usage || {}).length} partitions</p>
                    </div>
                    
                    <div class="metric-card">
                        <h3>Network</h3>
                        <div class="metric-value">
                            ${((network.network_io?.download_rate_mbps || 0) + (network.network_io?.upload_rate_mbps || 0)).toFixed(1)} MB/s
                        </div>
                        <p>â†“ ${(network.network_io?.download_rate_mbps || 0).toFixed(1)} MB/s</p>
                        <p>â†‘ ${(network.network_io?.upload_rate_mbps || 0).toFixed(1)} MB/s</p>
                    </div>
                </div>
                
                <div class="card">
                    <h2>System Information</h2>
                    <div class="metric-grid">
                        <div>
                            <h4>Uptime</h4>
                            <p>${data.kernel?.uptime_formatted || 'N/A'}</p>
                        </div>
                        <div>
                            <h4>Load Average</h4>
                            <p>${cpu.load_avg ? 
                                `${cpu.load_avg['1min']?.toFixed(2)} / ${cpu.load_avg['5min']?.toFixed(2)} / ${cpu.load_avg['15min']?.toFixed(2)}` : 
                                'N/A'}</p>
                        </div>
                        <div>
                            <h4>Active Users</h4>
                            <p>${data.kernel?.users || 0}</p>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <h2>Top Processes</h2>
                    <div style="overflow-x: auto;">
                        <table style="width: 100%; border-collapse: collapse;">
                            <thead>
                                <tr style="border-bottom: 2px solid #ddd;">
                                    <th style="padding: 8px; text-align: left;">PID</th>
                                    <th style="padding: 8px; text-align: left;">Name</th>
                                    <th style="padding: 8px; text-align: left;">CPU %</th>
                                    <th style="padding: 8px; text-align: left;">Memory %</th>
                                    <th style="padding: 8px; text-align: left;">Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${(data.processes?.top_cpu_processes || []).slice(0, 10).map(proc => `
                                    <tr style="border-bottom: 1px solid #eee;">
                                        <td style="padding: 8px;">${proc.pid || ''}</td>
                                        <td style="padding: 8px;">${(proc.name || '').substring(0, 20)}</td>
                                        <td style="padding: 8px;">${(proc.cpu_percent || 0).toFixed(1)}%</td>
                                        <td style="padding: 8px;">${(proc.memory_percent || 0).toFixed(1)}%</td>
                                        <td style="padding: 8px;">${proc.status || ''}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }
        
        // Load metrics when page loads
        window.addEventListener('load', () => {
            loadMetrics();
            
            // Update every 5 seconds
            setInterval(loadMetrics, 5000);
        });
    </script>
</body>
</html>