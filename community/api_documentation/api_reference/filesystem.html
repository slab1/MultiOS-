<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>File System API - MultiOS Documentation</title>
    <link rel="stylesheet" href="../assets/css/main.css">
    <link rel="stylesheet" href="../assets/css/components.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div id="app">
        <!-- Header -->
        <header class="header">
            <div class="container">
                <div class="header-content">
                    <div class="logo">
                        <a href="../index.html">
                            <i class="fas fa-microchip"></i>
                            <h1>MultiOS API Documentation</h1>
                        </a>
                    </div>
                    <div class="header-actions">
                        <div class="search-container">
                            <i class="fas fa-search"></i>
                            <input type="text" id="global-search" placeholder="Search API, tutorials, examples...">
                            <div id="search-results" class="search-results"></div>
                        </div>
                        <div class="theme-toggle">
                            <button id="theme-toggle" class="btn-icon">
                                <i class="fas fa-moon"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="sidebar">
            <div class="nav-content">
                <div class="nav-section">
                    <h3>API Reference</h3>
                    <ul>
                        <li><a href="kernel.html" class="nav-link">Kernel API</a></li>
                        <li><a href="memory.html" class="nav-link">Memory Management</a></li>
                        <li><a href="process.html" class="nav-link">Process Management</a></li>
                        <li><a href="filesystem.html" class="nav-link active">File System</a></li>
                        <li><a href="networking.html" class="nav-link">Network</a></li>
                        <li><a href="drivers.html" class="nav-link">Driver API</a></li>
                        <li><a href="gui.html" class="nav-link">GUI Framework</a></li>
                    </ul>
                </div>
                <div class="nav-section">
                    <h3>Tutorials</h3>
                    <ul>
                        <li><a href="../tutorials/beginner/index.html" class="nav-link">Beginner</a></li>
                        <li><a href="../tutorials/intermediate/index.html" class="nav-link">Intermediate</a></li>
                        <li><a href="../tutorials/advanced/index.html" class="nav-link">Advanced</a></li>
                    </ul>
                </div>
                <div class="nav-section">
                    <h3>Guides</h3>
                    <ul>
                        <li><a href="../guides/integration/rust.html" class="nav-link">Rust Integration</a></li>
                        <li><a href="../guides/integration/c.html" class="nav-link">C Integration</a></li>
                        <li><a href="../guides/integration/python.html" class="nav-link">Python Integration</a></li>
                    </ul>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <div class="container">
                <div class="content-header">
                    <h1>File System API</h1>
                    <p class="lead">Comprehensive file and directory operations for MultiOS</p>
                    <div class="content-meta">
                        <span class="badge badge-version">v1.0</span>
                        <span class="badge badge-module">filesystem</span>
                        <span class="badge badge-stability">Stable</span>
                    </div>
                </div>

                <!-- Quick Start Section -->
                <section class="content-section">
                    <h2>Quick Start</h2>
                    <div class="code-example-container">
                        <div class="code-example">
                            <div class="code-header">
                                <h4>Basic File Operations</h4>
                                <div class="code-actions">
                                    <button class="btn btn-sm btn-secondary run-example" data-example="filesystem-basic">
                                        <i class="fas fa-play"></i> Run
                                    </button>
                                    <button class="btn btn-sm btn-secondary copy-code" data-code="filesystem-basic">
                                        <i class="fas fa-copy"></i> Copy
                                    </button>
                                </div>
                            </div>
                            <pre><code class="language-rust">use multi::fs::{FileSystem, File, Directory};

// Create file system instance
let mut fs = FileSystem::new("/mnt/data")?;

// Write to file
let mut file = fs.create_file("hello.txt")?;
file.write_all(b"Hello, MultiOS!")?;
file.flush()?;

// Read from file
let mut file = fs.open_file("hello.txt")?;
let mut contents = String::new();
file.read_to_string(&mut contents)?;
println!("File contents: {}", contents);

// Directory operations
fs.create_directory("documents")?;
let entries = fs.list_directory(".")?;
for entry in entries {
    println!("Found: {}", entry.name);
}</code></pre>
                        </div>
                    </div>
                </section>

                <!-- File Operations -->
                <section class="content-section">
                    <h2>File Operations</h2>
                    <p>Create, read, write, and manipulate files with the MultiOS file system API.</p>
                    
                    <div class="api-section">
                        <h3>create_file()</h3>
                        <div class="api-description">
                            <p>Create a new file or truncate an existing file.</p>
                        </div>
                        <div class="code-example-container">
                            <div class="code-example">
                                <div class="code-header">
                                    <h4>Create and Write File</h4>
                                </div>
                                <pre><code class="language-rust">// Function signature
fn create_file(&mut self, path: &str) -> Result&lt;File, FileSystemError&gt;

// Usage example
let mut fs = FileSystem::new("/mnt/data")?;

// Create new file with data
let mut file = fs.create_file("data/config.json")?;
let config_data = r#"{"name": "MultiOS", "version": "1.0"}"#;
file.write_all(config_data.as_bytes())?;
file.sync_all()?; // Force write to disk</code></pre>
                            </div>
                        </div>
                    </div>

                    <div class="api-section">
                        <h3>open_file()</h3>
                        <div class="api-description">
                            <p>Open an existing file for reading or writing.</p>
                        </div>
                        <div class="code-example-container">
                            <div class="code-example">
                                <div class="code-header">
                                    <h4>Open and Read File</h4>
                                </div>
                                <pre><code class="language-rust">// Function signature
fn open_file(&mut self, path: &str) -> Result&lt;File, FileSystemError&gt;

// Usage example
let mut fs = FileSystem::new("/mnt/data")?;

// Open for reading
let mut file = fs.open_file("data/readme.txt")?;
let mut contents = String::new();
file.read_to_string(&mut contents)?;

// Open for reading and writing
let mut file = fs.open_file("data/log.txt")?;
file.seek(SeekFrom::End(0))?; // Go to end
file.write_all(b"New log entry\n")?;</code></pre>
                            </div>
                        </div>
                    </div>

                    <div class="api-section">
                        <h3>File Flags and Modes</h3>
                        <div class="code-example-container">
                            <div class="code-example">
                                <div class="code-header">
                                    <h4>Advanced File Opening</h4>
                                </div>
                                <pre><code class="language-rust">use multi::fs::{FileFlags, OpenMode};

// Open with specific flags
let mut file = fs.open_file_with_flags(
    "data/cache.bin", 
    FileFlags::CREATE | FileFlags::TRUNCATE | FileFlags::WRITE,
    OpenMode::Binary
)?;

// Open with read-only access
let mut read_file = fs.open_file_readonly("data/config.txt")?;

// Open with append mode
let mut append_file = fs.open_file_append("data/logs.txt")?;</code></pre>
                            </div>
                        </div>
                        <div class="parameters">
                            <h4>FileFlags</h4>
                            <table class="api-table">
                                <thead>
                                    <tr><th>Flag</th><th>Value</th><th>Description</th></tr>
                                </thead>
                                <tbody>
                                    <tr><td>READ</td><td>0x1</td><td>Open file for reading</td></tr>
                                    <tr><td>WRITE</td><td>0x2</td><td>Open file for writing</td></tr>
                                    <tr><td>CREATE</td><td>0x8</td><td>Create file if it doesn't exist</td></tr>
                                    <tr><td>TRUNCATE</td><td>0x10</td><td>Truncate file when opening</td></tr>
                                    <tr><td>APPEND</td><td>0x20</td><td>Append mode</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <!-- Directory Operations -->
                <section class="content-section">
                    <h2>Directory Operations</h2>
                    <p>Manage directories with creation, listing, and navigation operations.</p>
                    
                    <div class="api-section">
                        <h3>Directory Management</h3>
                        <div class="code-example-container">
                            <div class="code-example">
                                <div class="code-header">
                                    <h4>Create and Manage Directories</h4>
                                </div>
                                <pre><code class="language-rust">use multi::fs::{Directory, DirEntry};

// Create single directory
fs.create_directory("logs")?;

// Create directory with intermediate directories
fs.create_directories("data/projects/multi os/src")?;

// List directory contents
let entries = fs.list_directory("/mnt/data")?;
for entry in entries {
    match entry.entry_type {
        DirEntryType::File => println!("File: {}", entry.name),
        DirEntryType::Directory => println!("Directory: {}", entry.name),
        DirEntryType::Symlink => println!("Symlink: {}", entry.name),
    }
}</code></pre>
                            </div>
                        </div>
                    </div>

                    <div class="api-section">
                        <h3>Directory Navigation</h3>
                        <div class="code-example-container">
                            <div class="code-example">
                                <div class="code-header">
                                    <h4>Navigate and Change Directories</h4>
                                </div>
                                <pre><code class="language-rust">// Get current working directory
let current_dir = fs.get_current_directory()?;
println!("Current directory: {}", current_dir);

// Change working directory
fs.set_current_directory("/mnt/data/projects")?;

// Resolve relative paths
let full_path = fs.resolve_path("./src/main.rs")?;
println!("Full path: {}", full_path);

// Check if path exists
if fs.path_exists("config.ini") {
    println!("Configuration file exists");
}</code></pre>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- File Metadata -->
                <section class="content-section">
                    <h2>File Metadata and Attributes</h2>
                    <p>Retrieve and modify file properties, permissions, and timestamps.</p>
                    
                    <div class="api-section">
                        <h3>FileMetadata</h3>
                        <div class="code-example-container">
                            <div class="code-example">
                                <div class="code-header">
                                    <h4>Get File Information</h4>
                                </div>
                                <pre><code class="language-rust">use multi::fs::{FileMetadata, FileType, Permissions};

// Get file metadata
let metadata = fs.get_metadata("important.txt")?;

println!("File size: {} bytes", metadata.size());
println!("Is file: {}", metadata.is_file());
println!("Is directory: {}", metadata.is_directory());
println!("Created: {:?}", metadata.created());
println!("Modified: {:?}", metadata.modified());
println!("Accessed: {:?}", metadata.accessed());

// Get file permissions
let perms = metadata.permissions();
println!("Readable: {}", perms.is_readable());
println!("Writable: {}", perms.is_writable());
println!("Executable: {}", perms.is_executable());</code></pre>
                            </div>
                        </div>
                    </div>

                    <div class="api-section">
                        <h3>Modify Permissions</h3>
                        <div class="code-example-container">
                            <div class="code-example">
                                <div class="code-header">
                                    <h4>Change File Permissions</h4>
                                </div>
                                <pre><code class="language-rust">use multi::fs::{Permissions, PermissionMode};

// Change permissions
let mut perms = Permissions::new();
perms.set_readable(true);
perms.set_writable(true);
perms.set_executable(false);

fs.set_permissions("script.sh", perms)?;

// Set specific mode
fs.set_mode("config.ini", PermissionMode::OWNER_READ | PermissionMode::OWNER_WRITE)?;

// Set executable permission
fs.make_executable("launcher.sh")?;</code></pre>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- File Copying and Moving -->
                <section class="content-section">
                    <h2>File Copying and Moving</h2>
                    <p>Copy, move, and rename files and directories efficiently.</p>
                    
                    <div class="api-section">
                        <h3>Copy Operations</h3>
                        <div class="code-example-container">
                            <div class="code-example">
                                <div class="code-header">
                                    <h4>Copy Files and Directories</h4>
                                </div>
                                <pre><code class="language-rust">use multi::fs::{CopyOptions, CopyMode};

// Copy single file
fs.copy_file("source.txt", "destination.txt")?;

// Copy with options
let options = CopyOptions {
    mode: CopyMode::Overwrite,
    preserve_metadata: true,
    follow_symlinks: false,
};
fs.copy_file_with_options("config.ini", "backup/config.ini", options)?;

// Copy directory recursively
fs.copy_directory("src", "backup/src")?;

// Copy with progress callback
fs.copy_file_with_progress("large_file.bin", "backup/large_file.bin", 
    |bytes_copied, total_bytes| {
        let progress = (bytes_copied as f64 / total_bytes as f64) * 100.0;
        println!("Progress: {:.1}%", progress);
    })?;</code></pre>
                            </div>
                        </div>
                    </div>

                    <div class="api-section">
                        <h3>Move and Rename</h3>
                        <div class="code-example-container">
                            <div class="code-example">
                                <div class="code-header">
                                    <h4>Move and Rename Files</h4>
                                </div>
                                <pre><code class="language-rust">// Rename file
fs.rename_file("old_name.txt", "new_name.txt")?;

// Move file to different directory
fs.move_file("temp.log", "/var/log/temp.log")?;

// Move directory
fs.move_directory("old_project", "archive/old_project")?;

// Atomic rename (cross-filesystem)
fs.atomic_rename("temp_config", "active_config")?;</code></pre>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- File Locking -->
                <section class="content-section">
                    <h2>File Locking</h2>
                    <p>Implement file-level locking for concurrent access control.</p>
                    
                    <div class="api-section">
                        <h3>Locking Operations</h3>
                        <div class="code-example-container">
                            <div class="code-example">
                                <div class="code-header">
                                    <h4>Lock Files for Concurrent Access</h4>
                                </div>
                                <pre><code class="language-rust">use multi::fs::{FileLock, LockType, LockScope};

// Open file with locking
let mut file = fs.open_file_locked("shared_data.txt", 
    LockType::Exclusive, LockScope::Process)?;

// Acquire read lock
let mut read_file = fs.open_file_locked("data.txt", 
    LockType::Shared, LockScope::Process)?;

// Advisory locking
file.advisory_lock(LockType::Exclusive)?;

// Check if file is locked
if !file.is_locked() {
    file.advisory_lock(LockType::Exclusive)?;
    // Critical section
    file.advisory_unlock()?;
}</code></pre>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Memory-Mapped Files -->
                <section class="content-section">
                    <h2>Memory-Mapped Files</h2>
                    <p>Map files into memory for high-performance access patterns.</p>
                    
                    <div class="api-section">
                        <h3>Memory Mapping</h3>
                        <div class="code-example-container">
                            <div class="code-example">
                                <div class="code-header">
                                    <h4>Map File to Memory</h4>
                                </div>
                                <pre><code class="language-rust">use multi::fs::{MemoryMap, MapType};

// Create memory mapping
let mut mapping = fs.create_memory_map("large_data.bin", 
    0, // offset
    1024 * 1024, // size (1MB)
    MapType::ReadWrite)?;

// Access mapped memory
let data = mapping.as_mut_slice();
for byte in data.iter_mut() {
    *byte = 0x42;
}

// Flush changes to disk
mapping.flush()?;

// Sync entire mapping
mapping.sync_all()?;</code></pre>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Interactive File Explorer -->
                <section class="content-section">
                    <h2>Interactive File Explorer</h2>
                    <div class="interactive-demo">
                        <div class="demo-controls">
                            <button class="btn btn-primary" id="create-file">
                                <i class="fas fa-file"></i> Create File
                            </button>
                            <button class="btn btn-secondary" id="create-folder">
                                <i class="fas fa-folder"></i> Create Folder
                            </button>
                            <button class="btn btn-secondary" id="copy-item">
                                <i class="fas fa-copy"></i> Copy Item
                            </button>
                            <button class="btn btn-warning" id="delete-item">
                                <i class="fas fa-trash"></i> Delete Item
                            </button>
                        </div>
                        <div class="demo-visualization" id="filesystem-visualization">
                            <div class="file-tree" id="file-tree"></div>
                        </div>
                        <div class="demo-stats" id="demo-stats">
                            <div class="stat-item">
                                <span class="stat-label">Total Files:</span>
                                <span class="stat-value" id="total-files">0</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Total Folders:</span>
                                <span class="stat-value" id="total-folders">0</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Used Space:</span>
                                <span class="stat-value" id="used-space">0 MB</span>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- File System Monitoring -->
                <section class="content-section">
                    <h2>File System Monitoring</h2>
                    <p>Watch for file system changes and events in real-time.</p>
                    
                    <div class="api-section">
                        <h3>FileSystem Watcher</h3>
                        <div class="code-example-container">
                            <div class="code-example">
                                <div class="code-header">
                                    <h4>Monitor File System Events</h4>
                                </div>
                                <pre><code class="language-rust">use multi::fs::{FileSystemWatcher, WatchEvent};

// Create watcher for directory
let mut watcher = fs.create_watcher("/mnt/data")?;

// Watch for specific events
watcher.add_path("logs", WatchEvent::CREATE | WatchEvent::MODIFY)?;
watcher.add_path("config", WatchEvent::DELETE | WatchEvent::RENAME)?;

// Process events
while let Some(event) = watcher.next_event() {
    match event {
        WatchEvent::Created(path) => println!("File created: {}", path),
        WatchEvent::Modified(path) => println!("File modified: {}", path),
        WatchEvent::Deleted(path) => println!("File deleted: {}", path),
        WatchEvent::Renamed(old_path, new_path) => {
            println!("File renamed: {} -> {}", old_path, new_path);
        }
    }
}</code></pre>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Error Handling -->
                <section class="content-section">
                    <h2>Error Handling</h2>
                    <p>Handle file system errors with detailed error types and recovery strategies.</p>
                    
                    <div class="api-section">
                        <h3>FileSystemError</h3>
                        <div class="code-example-container">
                            <div class="code-example">
                                <div class="code-header">
                                    <h4>Handle File System Errors</h4>
                                </div>
                                <pre><code class="language-rust">use multi::fs::{FileSystemError, ErrorKind};

fn safe_file_operation(path: &str) -> Result&lt;String, String&gt; {
    let mut fs = FileSystem::new("/mnt/data")?;
    
    match fs.open_file(path) {
        Ok(mut file) => {
            let mut contents = String::new();
            match file.read_to_string(&mut contents) {
                Ok(_) => Ok(contents),
                Err(e) => Err(format!("Read error: {}", e))
            }
        }
        Err(error) => {
            match error.kind {
                ErrorKind::NotFound => {
                    println!("File not found: {}", path);
                    Err("File not found".to_string())
                }
                ErrorKind::PermissionDenied => {
                    println!("Permission denied: {}", path);
                    Err("Permission denied".to_string())
                }
                ErrorKind::DiskFull => {
                    println!("Disk full while accessing: {}", path);
                    Err("Disk full".to_string())
                }
                ErrorKind::IOError => {
                    println!("I/O error: {}", path);
                    Err("I/O error".to_string())
                }
                _ => Err(format!("File system error: {}", error))
            }
        }
    }
}</code></pre>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Best Practices -->
                <section class="content-section">
                    <h2>Best Practices</h2>
                    <div class="best-practices">
                        <div class="practice-item">
                            <h4><i class="fas fa-check-circle text-success"></i> Error Handling</h4>
                            <p>Always check file operations for errors and handle them appropriately.</p>
                        </div>
                        <div class="practice-item">
                            <h4><i class="fas fa-check-circle text-success"></i> Resource Management</h4>
                            <p>Close files and release resources promptly to prevent leaks.</p>
                        </div>
                        <div class="practice-item">
                            <h4><i class="fas fa-check-circle text-success"></i> Concurrent Access</h4>
                            <p>Use file locking when multiple processes need to access the same files.</p>
                        </div>
                        <div class="practice-item">
                            <h4><i class="fas fa-check-circle text-success"></i> Metadata Preservation</h4>
                            <p>Preserve file metadata when copying or moving files across file systems.</p>
                        </div>
                    </div>
                </section>
            </div>
        </main>
    </div>

    <!-- Scripts -->
    <script src="../assets/js/main.js"></script>
    <script src="../assets/js/search.js"></script>
    <script src="../assets/js/theme.js"></script>
    <script src="../assets/js/interactive.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    
    <script>
        // File System specific interactive features
        document.addEventListener('DOMContentLoaded', function() {
            let fileSystem = {
                name: '/',
                type: 'directory',
                children: [
                    {
                        name: 'bin',
                        type: 'directory',
                        children: [
                            { name: 'ls', type: 'file', size: '45KB' },
                            { name: 'cat', type: 'file', size: '38KB' },
                            { name: 'grep', type: 'file', size: '52KB' }
                        ]
                    },
                    {
                        name: 'home',
                        type: 'directory',
                        children: [
                            { name: 'README.md', type: 'file', size: '2KB' },
                            { name: 'config.txt', type: 'file', size: '1KB' }
                        ]
                    },
                    {
                        name: 'var',
                        type: 'directory',
                        children: [
                            { name: 'log', type: 'directory', children: [] },
                            { name: 'cache', type: 'directory', children: [] }
                        ]
                    },
                    { name: 'LICENSE', type: 'file', size: '4KB' },
                    { name: 'Makefile', type: 'file', size: '8KB' }
                ]
            };
            
            function renderFileSystem(node, container, level = 0) {
                const indent = '  '.repeat(level);
                
                const element = document.createElement('div');
                element.className = `fs-item ${node.type}`;
                element.style.marginLeft = `${level * 20}px`;
                element.innerHTML = `
                    <i class="fas fa-${node.type === 'directory' ? 'folder' : 'file'}"></i>
                    <span class="fs-name">${node.name}</span>
                    ${node.size ? `<span class="fs-size">${node.size}</span>` : ''}
                `;
                
                container.appendChild(element);
                
                if (node.type === 'directory' && node.children) {
                    node.children.forEach(child => {
                        renderFileSystem(child, container, level + 1);
                    });
                }
            }
            
            function updateStats() {
                let totalFiles = 0;
                let totalFolders = 0;
                let usedSpace = 0;
                
                function countItems(node) {
                    if (node.type === 'file') {
                        totalFiles++;
                        const sizeStr = node.size.replace(/[^\d.]/g, '');
                        usedSpace += parseFloat(sizeStr) || 0;
                    } else {
                        totalFolders++;
                        if (node.children) {
                            node.children.forEach(countItems);
                        }
                    }
                }
                
                countItems(fileSystem);
                
                document.getElementById('total-files').textContent = totalFiles;
                document.getElementById('total-folders').textContent = totalFolders;
                document.getElementById('used-space').textContent = usedSpace.toFixed(1) + ' MB';
            }
            
            function refreshTree() {
                const container = document.getElementById('file-tree');
                container.innerHTML = '';
                renderFileSystem(fileSystem, container);
                updateStats();
            }
            
            document.getElementById('create-file').addEventListener('click', function() {
                // Simulate file creation
                fileSystem.children.push({
                    name: `new_file_${Date.now()}.txt`,
                    type: 'file',
                    size: '1KB'
                });
                refreshTree();
            });
            
            document.getElementById('create-folder').addEventListener('click', function() {
                // Simulate folder creation
                fileSystem.children.push({
                    name: `new_folder_${Date.now()}`,
                    type: 'directory',
                    children: []
                });
                refreshTree();
            });
            
            document.getElementById('copy-item').addEventListener('click', function() {
                // Simulate copy operation
                alert('Copy operation simulated');
            });
            
            document.getElementById('delete-item').addEventListener('click', function() {
                // Simulate delete operation
                if (fileSystem.children.length > 0) {
                    fileSystem.children.pop();
                    refreshTree();
                }
            });
            
            // Initialize the tree
            refreshTree();
        });
    </script>
</body>
</html>