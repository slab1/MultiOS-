# Rust toolchain configuration for MultiOS
# This file ensures consistent Rust versions and components across development environments

[toolchain]
# Use Rust stable for MultiOS development
channel = "stable"
components = [
    "rustfmt",
    "clippy",
    "rust-docs",
    "llvm-tools-preview"
]
targets = [
    "x86_64-unknown-none",
    "aarch64-unknown-none", 
    "riscv64gc-unknown-none"
]

# Profile configuration for development
[profile.dev]
opt-level = 0
debug = true
split-debuginfo = "unpacked"

[profile.release]
opt-level = 3
lto = true
codegen-units = 1
panic = "abort"

[profile.custom-debug]
inherits = "dev"
debug = true
opt-level = 0

[profile.custom-release]
inherits = "release"
lto = "fat"
opt-level = 3

# Environment variables for consistent builds
[env]
CARGO_TERM_COLOR = "always"
RUST_BACKTRACE = "1"
RUST_LOG = "info"

# Build configuration
[build]
target = "x86_64-unknown-none"
rustflags = [
    "-C", "link-arg=-nostartfiles",
    "-C", "link-arg=-nostdlib",
]

# Registry configuration
[registries.crates-io]
protocol = "sparse"

# Feature configuration
[features]
default = ["serial"]
serial = []
qemu = []
# Target-specific features
x86_64 = []
aarch64 = []
riscv64 = []

# Resolver configuration
[resolver]
version = "2"